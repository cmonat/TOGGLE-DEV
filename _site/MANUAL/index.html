<!doctype html>
<!--[if lt IE 7]><html class="no-js ie6 oldie" lang="ja"><![endif]-->
<!--[if IE 7]>   <html class="no-js ie7 oldie" lang="ja"><![endif]-->
<!--[if IE 8]>   <html class="no-js ie8 oldie" lang="ja"><![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="ja"><!--<![endif]-->
<head>
	<meta charset="utf-8">
	<meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">

	<title>Manual</title>
	<meta name="description" content="">
	<meta name="author" content="">
	<meta name="viewport" content="width=device-width,initial-scale=1">

    <link href="http://localhost:4000/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/font-awesome/4.4.0/css/font-awesome.min.css">
    <link rel="stylesheet" href="http://localhost:4000/css/monokai.css">
    <link rel="stylesheet" type="text/css" media="screen" href="http://localhost:4000/css/stylesheet.css">
</head>
 <body>

      <!-- Static navbar -->
      <nav class="navbar navbar-default navbar-inverse navbar-static-top">
        <div class="container">
          <div class="navbar-header">
            <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false" aria-controls="navbar">
              <span class="sr-only">Toggle navigation</span>
              <span class="icon-bar"></span>
              <span class="icon-bar"></span>
              <span class="icon-bar"></span>
            </button>
            <a class="navbar-brand visible-xs" href="#">TOGGLE</a>
          </div>
          <div id="navbar" class="navbar-collapse collapse">
            <ul class="nav navbar-nav navbar-right">
              <p class="navbar-text hidden-xs hidden-sm"><a href="https://github.com/SouthGreenPlatform/TOGGLE/releases" class="navbar-link">Current version: <?php echo $version; ?></a></p>
              <li class="active"><a href="#">Home</a></li>
              <li class="dropdown">
                <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-haspopup="true" aria-expanded="false">Docs<span class="caret"></span></a>
                <ul class="dropdown-menu">
                  <li><a href="http://localhost:4000/README/">Readme</a></li>
                  <li><a href="examples/rna-seq/multiqc_report.html">Install</a></li>
                  <li><a href="examples/wgs/multiqc_report.html">Manual</a></li>
                  <li><a href="examples/bs-seq/multiqc_report.html">Realese Notes</a></li>
                  <li><a href="examples/hi-c/multiqc_report.html">Know Issues</a></li>
                </ul>
                <li class="active"><a id="forkme_banner" href="">View on GitHub</a></li>
              </li>
            </ul>
          </div>
        </div>
      </nav>
      <!--/.nav-collapse -->
    <!-- Header -->
    <div id="header_wrap" class="outer">
        <header class="inner">
          <section id="downloads">
            <a class="zip_download_link" href="#">Download as a .zip file</a>
            <a class="tar_download_link" href="#">Download as a tar.gz file</a>
          </section>
          <h1 id="project_title">TOGGLE</h1>
          <h2 id="project_tagline">Toolbox for generic NGS analyses</h2>
        </header>
    </div>

<body>
    <!-- MAIN CONTENT -->
    <div id="main_content_wrap" class="outer">
      <section id="main_content" class="inner">
        <h1 id="title"><a href="http://localhost:4000">TOGGLE web site</a></h1>

      </section>
    </div>

<div id="main-container">
	<div id="main" class="wrapper clearfix">

		<article>
{"layout"=>"page", "title"=>"Manual", "permalink"=>"/MANUAL/", "content"=>"MANUAL for TOGGLE v0.3 using ONTHEFLY creation of PIPELINES\n===========\n\n\n# SUMMARY\n\n* [PRE REQUISITES](#prerequisites)\n* [LAUNCHING AN ANALYSIS](#launching)\n* [RESULTING FOLDER](#finalFolder)\n* [SENDING OPTIONS](#sendingOptions)\n* [CREATING A PIPELINE](#creatingPipeline)\n* [PROVIDING AN ORDER](#order)\n* [SAME SOFTWARE REPEATED MULTIPLE TIMES](#samesoftmultiple)\n* [GIVING A COMMON STEP TO ALL INDIVIDUALS](#commonstep)\n* [STARTING ONLY A COMMON TREATMENT](#commononly)\n* [CLEANING STEPS](#cleaning)\n* [COMPRESSING STEPS](#compressing)\n* [SCHEDULER AND PARALLEL RUNS](#scheduling)\n* [OUTPUT AND ERROR LOGS](#logs)\n* [DRAWING THE PIPELINE](#drawing)\n* [PROCESS_RADSTACKS STEPS](#processradstacks)\n\n<p align=\"justify\">\nThe TOGGLEv0.3 *onTheFly* version allows users to create their own customized pipelines.\nYou can modify not only the different options for each software but also define specific organization for your analysis.\n</p>\n<p align=\"justify\">\nYou can therefore remove some steps compared to the previous version, starting from SAM/BAM or VCF files instead of FASTQ only, asking for individual treatments only,\nindividual then common (such as mapping followed by common calling), or even only common treatment.\n</p>\n\n# <a name=\"prerequisites\"></a>PRE REQUISITES\n\nTHE FILE NAMES MUST BE UNDER THE FORM **individual1_1.fastq**, **mapping1.sam**, **myVcf.vcf**\n\nTHE ONLY DOT ('.') ALLOWED IN NAMES IS FOR THE EXTENSION. The text before the dot will be used as individual names.\n\nFor *Fastq* files, only one underscore ('_') is authorized, before the direction of sequences ( _1, _2 or _R1, _R2), just before the extension (*.fastq*).\n\nPlease use only UTF-8 standard symbols, no weird characters or space, pipe, tilde or any type of commas.\n\n# <a name=\"launching\"></a>Launching an analysis\nThe current version is based on the **toggleGenerator.pl** script\n\n{% highlight bash %}\n  toggleGenerator.pl -d|--directory DIR -c|--config FILE -o|--outputdir DIR [-r|--reference FILE] [-k|--keyfile FILE] [-g|--gff FILE] [-nocheck|--nocheckFastq] [--help|-h]\n{% endhighlight %}\n\n| Required named arguments:       |                                                                                                                                |\n| :------------------------------ | :----------------------------------------------------------------------------------------------------------------------------- |\n| -d / --directory DIR:           | a folder with raw data to be treated (FASTQ, FASTQ.GZ, SAM, BAM, VCF)                                                          |\n| -c / --config FILE:             | generally it is the *software.config.txt* file but it can be any text file structured as shown below.                          |\n| -o / --outputdir DIR:           | the current version of TOGGLE will not modify the initial data folder but will create an output directory with all analyses in.|\n\n| Optional named arguments:       |                                                                                                                                |\n| :------------------------------ | :----------------------------------------------------------------------------------------------------------------------------- |\n| -r / --reference FILE:          | the reference FASTA file to be used. (1)                                                                                           |\n| -g / -gff FILE:                 | the GFF file to be used for some tools.                                                                                        |\n| -k / --keyfile FILE:            | the keyfile use for demultiplexing step.                                                                                       |\n| -nocheck / --nocheckFastq:      | by default toggle checks if fastq format is correct in every file. This option allows to skip this step.                       |\n| -h / --help:                    | show help message and exit                                                                                                     |\n\n(1): If no index exists it will be created accordingly to the pipeline requested index. If the index exist, they will not be re-created UNLESS the pipeline order (see below) expressively requests it (updating the index e.g.)\n\nAll the the paths (files and folders) can be provided as absolute (/home/mylogin/data/myRef.fasta) or relative (../data/myRef.fasta).\n\nThe *SNPdiscoveryPaired.config.txt* file is an example of how to customize your pipeline.\n\nAny software configuration will start as follows:\n\n{% highlight perl %}\n $First Software\n option1\n option2\n\n $Second Software\n option1\n option2\n{% endhighlight %}\n\n # <a name=\"finalFolder\"></a>What will you have in results ?\n\nTOGGLE will generate an output folder containing different files and subfolders, as follows:\n\n ![TOGGLE Final Folder]({{ site.url }}/images/toggleOutputFolder.png)\n\n The final results are contained in the **finalResults** folder.\n TOGGLE will also copy the *software config* file corresponding to the analysis, in order users can recover their options.\n The **output** folder contains all sub analyses, i.e. the individual analyses or intermediate data.\n\n# <a name=\"sendingOptions\"></a>Sending options\nAs for the previous version, you can address any option to any given software (as soon as the given option exists for the given software ^^) as follows:\n\n{% highlight perl %}\n$bwaAln\n-e=1\n-n=5\n{% endhighlight %}\n\nYou can also write as follows\n\n{% highlight perl %}\n$BWA ALN\n-e=1\n-n=5\n{% endhighlight %}\n\nThe software name is not case sensitive and the subprogram can be \"glued\" to the name (bwaALN is recognized, as well as bwa aln).\n\nIf your option has an equal symbol within, such as **-l hostname=MyNode**, you have to write the option as follows:\n\n{% highlight perl %}\n-l hostname=MyNode\n{% endhighlight %}\n\n# <a name=\"creatingPipeline\"></a>Creating a pipeline\n\nThe **toggleGenerator.pl** script will use the configuration file informations (generally named as *software.config.txt* file, but not mandatory) to create specific pipeline scripts in the output folder called **toggleBzz.pl** for individual treatments (individual mapping e.g.) and **toggleMultiple.pl** for global treatment (global SNP calling e.g.).\n\nThe order will be verified before creating the scripts, by checking if the output files from the step n-1 will be accepted as input for the step n.\n\n![TOGGLE pipeline]({{ site.url }}/images/TogglePipeline.png)\n\n### <a name=\"order\"></a>Providing an order\nThe order of a specific pipeline is provided in the *software.config.txt* as the software *order*\n\nThus, if you provide option such as:\n\n{% highlight perl %}\n$order\n1=bwa aln\n2=BWASAMPE\n3=samtools view\n{% endhighlight %}\n\nYou will obtain a pipeline taking fastq files (plain text of gzipped), aligning them upon a given reference using bwa aln/sampe, and finally cleaning the resulting sam and providing a BAM file (if samtools view option are as such).\n\nNote that the way you write the name of the step is not really important, e.g. it is not case-sensitive, and can have space between the different words. A dedicated module will adjust everything.\n\nYou can start from any type of format recognized by TOGGLE at any block from TOGGLE. Thus, if you have a raw VCF file you can start from this one at step one and clean it (**even if your VCF contains informations for multiple individuals**):\n\n{% highlight perl %}\n$order\n1=gatkVariantFiltrator\n2=gatkSelectVariants\n{% endhighlight %}\n\n**BE CAREFUL**: You can comment any step using a '#' symbol before it (ex *#3=bwaAln*) to avoid to retype all numbers. However, such a comment will provoke anomalies in cleaning and compressing steps. The best approach is to provide a list of following numbers (e.g. 1, 2, 3, 4 and not 1, 3, 4). This is also true for steps higher than 1000.\n\n\n### <a name=\"samesoftmultiple\"></a>Same software repeated multiple times\n\nIf you want to adress multiple times the same step BUT with different configurations (e.g. a first samtools view to obtain a BAM then a second samtools view to clean this BAM using the -f option), you have to indicate as follows\n\n{% highlight perl %}\n$order\n1=bwa aln\n2=BWASAMPE\n3=samtools view 1\n4=samtools view 2\n{% endhighlight %}\n\nIn the same time you have to provide the same informations in your configuration:\n\n{% highlight perl %}\n$samtoolsView 1\n-Sb\n$samtools View 2\n-f 0x02\n{% endhighlight %}\n\n**BE CAREFUL**: in such multiple times repeated software, you have to put a space between the software name and the step (ex samtoolsview 1 and samtoolsView 2) in the order as well as in the options !!\n\n\n### <a name=\"commonstep\"></a>Giving a common step to all individuals (multiple entry files)\n\nIf you want for instance to map all individuals (multiple files) separately then perform a common SNP calling, please add a step number higher than 999.\n\n{% highlight perl %}\n$order\n1=bwaAln\n2=bwaSampe\n3=picardTools SortSam\n1000=gatkUnifiedGenotyper\n{% endhighlight %}\n\nThis pipeline will map FASTQ then sort per coordinates the SAM for each individuals, and then will launch a common step for all as a global SNP calling. You can add after this calling other steps (1001=gatkVariantFiltrator for example).\n\n**Warnings**: if you want to map and call SNP from only one file, you do not need to call a 1000+ step (here *gatkUnifiedGenotyper* would be then the 4th step).\n\n### <a name=\"commononly\"></a>Starting only as a common treatment\nIf you want only a global treatment **for multiple files** (you may have all your formatted BAM and you want to perform the calling and subsequent steps), you can create the following pipeline:\n\n{% highlight perl %}\n$order\n1000=gatk UnifiedGenotyper\n1001=gatk VariantFiltrator\n1002=gatkSelectVariants\n{% endhighlight %}\n\nThe pipeline will treat the data as a global pipeline in this case, without separating the individual files.\n\n# <a name=\"cleaning\"></a>Cleaning steps\nIn order to gain hard drive space, you may want to remove some steps from your complete analysis.\n\nIn this case, you can specify in the configuration file which step must be REMOVED along the pipeline (as soon as the step following them has been correctly completed), using the key *cleaner*.\n\nAs an example\n\n{% highlight perl %}\n$order\n1=bwaAln\n2=bwaSampe\n3=samtools sort\n\n$cleaner\n1\n2\n{% endhighlight %}\n\nThere only the last step result (samtools sort) will be conserved. The folders and logs of the cleaned steps are conserved, but not the resulting files.\n\n**NOTE**: the last step will never be cleaned. This is true for single analyses (steps lower than 999 - *toggleBzz.pl* script) as well as for common steps (higher than 1000 - *toggleMultiple.pl* script)\n\n# <a name=\"compressing\"></a>Compressing steps\nIn order to gain hard drive space but conserving data, you may want to compress some steps from your complete analysis.\n\nIn this case, you can specify in the configuration file which step must be COMPRESSED in tar.gz along the pipeline (as soon as the step following them has been correctly completed), using the key *compress*.\n\nAs an example\n\n{% highlight perl %}\n$order\n1=bwaAln\n2=bwaSampe\n3=samtools sort\n\n$compress\n1\n2\n{% endhighlight %}\n\nThere only the last step result (samtools sort) will be conserved, the other being compressed in their respective tar.gz archive. The folders and logs of the compressed steps are conserved, but not the resulting files.\n\n**NOTE**: as for the cleaner system, the last step will never be compressed. This is true for single analyses (steps lower than 999 - *toggleBzz.pl* script) as well as for common steps (higher than 1000 - *toggleMultiple.pl* script).\n\nBE CAREFUL: CLEANING IS OF HIGHER ORDER THAN COMPRESS. If the same step is required to be cleaned AND compressed, it will be only cleaned!\n\n# <a name=\"scheduling\"></a>Scheduler and parallel runs\nThe current version is scheduler-aware (**SGE**, **MPRUN**, **Slurm** and **LSF** on v0.3+), and is able to decide by itself to launch on such a system.\nThe jobs will be launched in parallel however only if the *software.config* file contains informations for scheduling, *i.e.* the queue name, number of core/threads per jobs, etc...\n\nAs an example for **SGE**:\n\n{% highlight perl %}\n$sge\n-q myqueue.q\n-pe ompi 2\n-b Y\n-cwd\n-V\n{% endhighlight %}\n\nIf the *software.config* file contains those **SGE/Slurm/MPRUN/LSF** informations AND the machine is **SGE/Slurm/MPRUN/LSF** capable, the *toggleBzz.pl* and the *toggleMultiple.pl* scripts will be launched as parallel jobs.\n\nMoreover, in parallel as in linear mode, an error in one individual will not stop the whole process. This individual will be marked as error in the error log, but the others will continue.\n\n**NOTE**: If you need to provide specific ENVIRONMENT variables in your jobs (e.g. *export* or else), you can provide the $env key in your software.config file\n\n{% highlight perl %}\n$env\nexport PATH=$PATH:/my/other/PATH\nexport PERL5LIB=$PERL5LIB/my/new/path\n{% endhighlight %}\n\n# <a name=\"logs\"></a>Output and Error Logs\n\nTOGGLE will generate two main types of logs, the *.o* for normal output and the *.e* for the errors and warnings (these last ones are normally empty files).\nEach level of TOGGLE will generate this pair of log:\n* **GLOBAL_ANALYSIS_date.o/.e** logs represent the general output for the complete analysis (*toggleGenerator.pl* logs). They are located at the root of the output directory.\n* **IndividualName_global_log.o/.e** logs represent the local output for sub analysis (*toggleBzz.pl* and *toggleMultiple.pl* logs). They are located in their respective subdirectories in the output folder.\n\n# <a name=\"drawing\"></a>Drawing the pipeline\nIf *Graphviz* is installed on the running server, the **toggleGenerator.pl** script will also generate a graphical view of the pipeline in the output folder.\nIf *Graphviz* is not installed, a .dot file is nevertheless created, allowing the user to create a graphical view on another machine having *Graphviz*\n\n# <a name=\"processradstacks\"></a>Process_Radstacks step\nIf process_radstacks from stacks is used in your pipeline, you have to put it as the fist step else TOGGLE return you an error.\n", "dir"=>"/MANUAL/", "name"=>"MANUAL.md", "path"=>"MANUAL.md", "url"=>"/MANUAL/"}
		</article>

<!--
<aside>
	<h3>aside</h3>
	<p>Lorem ipsum dolor sit amet, consectetur adipiscing elit. Aliquam sodales urna non odio egestas tempor. Nunc vel vehicula ante. Etiam bibendum iaculis libero, eget molestie nisl pharetra in. In semper consequat est, eu porta velit mollis nec. Curabitur posuere enim eget turpis feugiat tempor. Etiam ullamcorper lorem dapibus velit suscipit ultrices.</p>
</aside>-->

	</div> <!-- #main -->
</div> <!-- #main-container -->
    <!-- Placed at the end of the document so the pages load faster -->
    <script src="http://localhost:4000/js/jquery-1.11.3.min.js"></script>
    <script src="http://localhost:4000/js/bootstrap.min.js"></script>
    <script src="http://localhost:4000/js/homepage.js"></script>
    <script src="http://localhost:4000/js/libs/modernizr-2.0.6.min.js"></script>

    <!-- Altmetric -->
    <script type='text/javascript' src='https://d1bxh8uas1mnw7.cloudfront.net/assets/embed.js'></script>

    <!-- Gitter -->
    <script>
      ((window.gitter = {}).chat = {}).options = {
        room: 'ewels/MultiQC',
        activationElement: '#gitter_btn',
      };
    </script>
    <script src="https://sidecar.gitter.im/dist/sidecar.v1.js" async defer></script>

    <!-- Google Analytics -->
    <script>
      (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
      (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
      m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
      })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

      ga('create', 'UA-68098153-1', 'auto');
      ga('send', 'pageview');

    </script>

    <!-- FOOTER  -->
    <div id="footer_wrap" class="outer">
      <footer class="inner">
        <p class="copyright">TOGGLE <a href="https://github.com/jasoncostello">link</a></p>
        <p>Citation <a href="http://pages.github.com">Monat et al</a></p>
      </footer>
    </div>

<script src="//ajax.googleapis.com/ajax/libs/jquery/1.7.1/jquery.min.js"></script>
<script>window.jQuery || document.write('<script src="js/libs/jquery-1.7.1.min.js"><\/script>')</script>

<script src="http://localhost:4000/js/script.js"></script>
<script>
	var _gaq=[['_setAccount','UA-20543951-2'],['_trackPageview']];
	(function(d,t){var g=d.createElement(t),s=d.getElementsByTagName(t)[0];g.async=1;
	g.src=('https:'==location.protocol?'//ssl':'//www')+'.google-analytics.com/ga.js';
	s.parentNode.insertBefore(g,s)}(document,'script'));
</script>

<!--[if lt IE 7 ]>
	<script src="//ajax.googleapis.com/ajax/libs/chrome-frame/1.0.2/CFInstall.min.js"></script>
	<script>window.attachEvent("onload",function(){CFInstall.check({mode:"overlay"})})</script>
<![endif]-->

</body>
</html>
